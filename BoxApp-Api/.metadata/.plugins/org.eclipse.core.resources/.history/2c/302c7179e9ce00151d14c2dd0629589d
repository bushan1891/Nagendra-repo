package com.jcs.util;

import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Paths;
import java.util.ArrayList;
import java.util.List;
import java.util.logging.Level;
import java.util.logging.Logger;

import com.box.sdk.BoxAPIConnection;
import com.box.sdk.BoxCollaboration;
import com.box.sdk.BoxCollaborator;
import com.box.sdk.BoxDeveloperEditionAPIConnection;
import com.box.sdk.BoxEnterprise;
import com.box.sdk.BoxFile;
import com.box.sdk.BoxFolder;
import com.box.sdk.BoxItem;
import com.box.sdk.BoxUser;
import com.box.sdk.BoxUser.Info;
import com.box.sdk.EncryptionAlgorithm;
import com.box.sdk.IAccessTokenCache;
import com.box.sdk.InMemoryLRUAccessTokenCache;
import com.box.sdk.JWTEncryptionPreferences;

public class BoxUtil {
	private static final String CLIENT_ID = "dh9zf6o6klqdmkugv1bxsupo7c5b1aio";
    private static final String CLIENT_SECRET = "5Vxtz5s2otvEHnl4bvia0qJeylNSfg36";
    private static final String ENTERPRISE_ID = "617897";
    private static final String PUBLIC_KEY_ID = "0bta57an";
    private static final String PRIVATE_KEY_FILE = "/Users/bushan/Nagendra-repo/BoxApp-Api/BoxApp-Api/private_key.pem";
    private static final String PRIVATE_KEY_PASSWORD = "bushanrock1";
    private static final String APP_USER_NAME = "bushan";
    private static final int MAX_CACHE_ENTRIES = 100;
	
	public static BoxAPIConnection getApi() throws IOException{
		// enter the developer token here 
		
		Logger.getLogger("com.box.sdk").setLevel(Level.OFF);
		
		String privateKey = new String(Files.readAllBytes(Paths.get(PRIVATE_KEY_FILE)));
		
		
		
	//	BoxAPIConnection api = new BoxAPIConnection("79tiGi4HxO9qvFzMvexzJBEpE0cpGNj4");
	""

        JWTEncryptionPreferences encryptionPref = new JWTEncryptionPreferences();
        encryptionPref.setPublicKeyID(PUBLIC_KEY_ID);
        encryptionPref.setPrivateKey(privateKey);
        encryptionPref.setPrivateKeyPassword(PRIVATE_KEY_PASSWORD);
        encryptionPref.setEncryptionAlgorithm(EncryptionAlgorithm.RSA_SHA_256);

        //It is a best practice to use an access token cache to prevent unneeded requests to Box for access tokens.
        //For production applications it is recommended to use a distributed cache like Memcached or Redis, and to
        //implement IAccessTokenCache to store and retrieve access tokens appropriately for your environment.
        IAccessTokenCache accessTokenCache = new InMemoryLRUAccessTokenCache(MAX_CACHE_ENTRIES);

        BoxDeveloperEditionAPIConnection api = BoxDeveloperEditionAPIConnection.getAppUserConnection("195182", CLIENT_ID, CLIENT_SECRET, encryptionPref);
        BoxFolder rootFolder = BoxFolder.getRootFolder(api);
      
     System.out.println(rootFolder.getID());
   
       
       BoxUser.Info userInfo = BoxUser.getCurrentUser(api).getInfo();
       System.out.format("Welcome, %s!\n\n", userInfo.getName() );

       
        listFolder(rootFolder, 0);
        
        
        
        
        
	
		return api;
		
	}
	
	
	private static void listFolder(BoxFolder folder, int depth) {
        for (BoxItem.Info itemInfo : folder) {
            String indent = "";
            for (int i = 0; i < depth; i++) {
                indent += "    ";
            }

            System.out.println(indent + itemInfo.getName() + itemInfo.getID());
            if (itemInfo instanceof BoxFolder.Info) {
                BoxFolder childFolder = (BoxFolder) itemInfo.getResource();
                if (depth < 1) {
                    listFolder(childFolder, depth + 1);
                }
            }
        }
	}
	
	
	public static BoxFolder getClaimFolder()throws IOException {

		BoxAPIConnection api = BoxUtil.getApi();
		BoxFolder Folder = new BoxFolder(api, "6372398869");

		return Folder;

	}

	public static BoxFolder getUserFolder()throws IOException {

		BoxAPIConnection api = BoxUtil.getApi();
		BoxFolder Folder = new BoxFolder(api, "6372397685");

		return Folder;

	}
	
	
	public static BoxItem.Info getSearchResult(BoxFolder rootFolder ,String str ){
		
		BoxItem.Info result = null ;
		
		for(BoxItem.Info info : rootFolder ){
		if(info.getName().equals(str))
			return info;
		}
			
		return result;
	}
	
	
	
}
